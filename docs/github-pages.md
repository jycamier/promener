# GitHub Pages Documentation

Promener automatically generates and publishes HTML documentation examples to GitHub Pages on every push to the `main` branch.

## Viewing the Documentation

The live documentation is available at:

**https://jycamier.github.io/promener/**

## What's Included

The GitHub Pages site includes:
- **Complete HTML documentation** generated from `testdata/with_cue_mod/metrics.cue`
- **Interactive features**: Search, dark mode, copy-to-clipboard
- **Metric examples**: PromQL queries and alert rules
- **Label validation**: CEL expressions displayed for each label
- **Deprecation warnings**: Visual indicators for deprecated metrics

## How It Works

The documentation is automatically generated by the GitHub Actions workflow at `.github/workflows/docs.yaml`:

1. **Trigger**: Runs on push to `main` when CUE files or code changes
2. **Build**: Compiles Promener from source
3. **Generate**: Runs `promener html -i testdata/with_cue_mod/metrics.cue -o index.html`
4. **Deploy**: Publishes to GitHub Pages

## Configuration

### Enable GitHub Pages

To enable GitHub Pages for your fork:

1. Go to **Settings** → **Pages**
2. Under "Build and deployment":
   - Source: **GitHub Actions**
3. Save

The workflow will automatically deploy on the next push to `main`.

### Workflow Configuration

The workflow (`.github/workflows/docs.yaml`) includes:

```yaml
on:
  push:
    branches:
      - main
    paths:
      - 'testdata/**/*.cue'
      - '.github/workflows/docs.yaml'
      - 'internal/**'
      - 'cmd/**'
```

This means documentation regenerates when:
- CUE specification files change
- The workflow itself changes
- Generator or command code changes

### Permissions

The workflow requires these permissions:

```yaml
permissions:
  contents: read    # Read repository contents
  pages: write      # Deploy to GitHub Pages
  id-token: write   # OIDC token for deployment
```

## Local Testing

Test documentation generation locally before pushing:

```bash
# Build promener
go build

# Generate HTML documentation
./promener html -i testdata/with_cue_mod/metrics.cue -o docs.html

# Open in browser
open docs.html  # macOS
xdg-open docs.html  # Linux
start docs.html  # Windows
```

## Customization

### Use Your Own CUE File

To use a different CUE specification:

1. Edit `.github/workflows/docs.yaml`
2. Change the input file:
   ```yaml
   - name: Generate HTML documentation
     run: |
       mkdir -p docs-output
       ./promener html -i path/to/your/metrics.cue -o docs-output/index.html
   ```

### Add Multiple Documentation Pages

Generate multiple HTML files:

```yaml
- name: Generate HTML documentation
  run: |
    mkdir -p docs-output
    ./promener html -i testdata/example1.cue -o docs-output/example1.html
    ./promener html -i testdata/example2.cue -o docs-output/example2.html

    # Create index page with links
    cat > docs-output/index.html << 'EOF'
    <!DOCTYPE html>
    <html>
    <head><title>Promener Examples</title></head>
    <body>
      <h1>Promener Documentation Examples</h1>
      <ul>
        <li><a href="example1.html">Example 1</a></li>
        <li><a href="example2.html">Example 2</a></li>
      </ul>
    </body>
    </html>
    EOF
```

### Add Custom Styling

Include additional CSS or assets:

```yaml
- name: Add custom assets
  run: |
    cp -r assets/ docs-output/
    cp custom-style.css docs-output/
```

## Troubleshooting

### Documentation Not Updating

1. **Check workflow status**: Go to **Actions** tab to see if workflow succeeded
2. **Verify permissions**: Ensure GitHub Pages has write permission in repository settings
3. **Check paths**: Workflow only runs when specified paths change
4. **Manual trigger**: Go to Actions → Documentation → Run workflow

### Build Failures

Common issues:

1. **CUE validation errors**: Run `promener vet` locally to check for errors
2. **Missing dependencies**: Ensure Go version matches (1.21+)
3. **Module issues**: For CUE modules, ensure `cue.mod/module.cue` is present

Check logs in the Actions tab for detailed error messages.

### GitHub Pages Not Enabled

Error: `Error: No uploaded artifact was found!`

**Solution**: Enable GitHub Pages in repository settings with source set to "GitHub Actions"

## Example Specifications

The example uses `testdata/with_cue_mod/metrics.cue` which demonstrates:

- **CUE modules**: Imports from `github.com/jycamier/promener-standards`
- **Standard metrics**: Pre-defined latency and traffic metrics
- **Label validation**: CEL expressions for HTTP methods and status codes
- **Deprecation**: Old metrics with migration guidance
- **Common labels**: Reusable label definitions

## See Also

- [CUE Specification](cue-specification.md) - Complete CUE format reference
- [HTML Documentation](../README.md#documentation-generation) - HTML generation guide
- [GitHub Actions Documentation](https://docs.github.com/en/pages/getting-started-with-github-pages)
